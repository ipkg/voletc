<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>vol-etc by ipkg</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">vol-etc</h1>
      <h2 class="project-tagline">Distributed, Persistent Docker Volume Plugin for Dynamic Application Configurations</h2>
      <a href="https://github.com/ipkg/voletc" class="btn">View on GitHub</a>
      <a href="https://github.com/ipkg/voletc/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/ipkg/voletc/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h2>

<p>voletc (pronounced vol etc) is a Docker Volume Plugin that allows to create volumes containing application configurations that can be accessed on any of your docker nodes.  </p>

<p>Once created the application no longer needs to worry about obtaining application specific configurations.  The mounted volume will contain all of config file/s based on the templates and keys you've specified during volume creation.</p>

<p>The configuration data can be stored in consul or etcd but currently only consul support exists.</p>

<p>A config volume name must be in the following format</p>

<pre><code>&lt;name&gt;-&lt;version&gt;-&lt;environment&gt;
</code></pre>

<p>Based on this a volume is created per unique <code>name</code>, <code>version</code> and <code>environment</code>.  The layout looks like this:</p>

<ul>
<li>Each application has versions.</li>
<li>Each version contains an associated template along with environments.</li>
<li>Each environment contains its keys.</li>
<li>Templates are shared across each environment and per environment keys are applied to the template</li>
</ul>

<p>Volumes can be managed directly through <a href="#docker"><strong>docker</strong></a> and via the <a href="#command-line"><strong>CLI</strong></a>.</p>

<h2>
<a id="docker" class="anchor" href="#docker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Docker</h2>

<p>The Docker CLI can be used to manage volumes using the <code>voletc</code> driver and driver specific options.</p>

<h3>
<a id="creating-volumes" class="anchor" href="#creating-volumes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating volumes</h3>

<pre><code>docker volume create --name test-0.1.0-dev -d voletc \
    --opt=subpath/key=value \
    --opt=template:config.json='{"key":"${subpath/key}"}'
</code></pre>

<p>This creates a config volume with a <code>template</code> that will be called <code>config.json</code> and will also contain a key called <code>subpath/key</code> with a value of <code>value</code> persisting them to the backend.  When docker requests the volume to be mounted the configuration files will be dynamically generated and available on the newly created volume.</p>

<p><code>template</code> is a keyword signifying that key contains template data rather than just key value data.</p>

<h3>
<a id="using-volumes" class="anchor" href="#using-volumes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using volumes</h3>

<pre><code>docker run --rm -it -v test-0.1.1-dev:/opt/myconfigs/ busbox
</code></pre>

<p>Your config should now be available at <code>/opt/myconfigs/config.json</code> in the running container.  If there are multiple config files they will all be located under <code>/opt/myconfigs</code>.  The naming of the config is controlled by what has been supplied as part of the <code>--opt=template:&lt;name&gt;.&lt;ext&gt;</code> argument at the time of creation.</p>

<h3>
<a id="removing-volumes" class="anchor" href="#removing-volumes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Removing volumes</h3>

<pre><code>docker volume rm test-0.1.1-dev
</code></pre>

<p>Removing a volume removes all the associated keys from the backend for the given environment.  It does not remove the template (as it is associated to the version).</p>

<p>Currently, there is not a way via Docker to change volumes configs once they have been created.  You can either use the <a href="#command-line"><strong>CLI</strong></a> or destroy and re-create the volume.</p>

<h2>
<a id="command-line" class="anchor" href="#command-line" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Command Line</h2>

<p>The command line tool provides more functionality in regards to volume management than are available through docker.</p>

<pre><code>Usage:

  voletc [options] &lt;cmd&gt; [name] [key=value] [key=value]

  A tool to manage application configuration volumes.

Commands:

  ls        List volumes
  create    Create new volume
  edit      Edit volume configurations
  info      Show volume info
  rm        Destroy volume i.e. remove all keys
  render    Show rendered volume templates
  version   Show version

Options:

  -b string
        Service bind address (default "127.0.0.1:8989")
  -dir string
        Data directory (default "/opt")
  -prefix string
        Path prefix to store data under (default "voletc")
  -uri string
        Backend uri (default "consul://localhost:8500")
</code></pre>

<p>Aside from the global options each command also has its specific options.</p>

<h3>
<a id="create-a-volume" class="anchor" href="#create-a-volume" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create a volume</h3>

<pre><code>voletc create test-0.1.1-dev \
    db/name=dbname \
    db/user=dbuser \
    template:config.json=./config.json \
    template:inline.json='{"db_name": "${db/name}", "db_user": "${db/user}"}'
</code></pre>

<p>To simply simulate the creation rather than actually creating the volume, use the <code>-dryrun</code> flag.</p>

<h3>
<a id="get-volume-details" class="anchor" href="#get-volume-details" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get volume details</h3>

<pre><code>voletc info test-0.1.1-dev
</code></pre>

<h3>
<a id="list-volumes" class="anchor" href="#list-volumes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>List volumes</h3>

<pre><code>voletc ls
</code></pre>

<h3>
<a id="edit-a-volume" class="anchor" href="#edit-a-volume" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Edit a volume</h3>

<pre><code>voletc edit test-0.1.1-dev db/user=new_user
</code></pre>

<p>To simply simulate the update rather than actually updating the volume configs, use the <code>-dryrun</code> flag.</p>

<h3>
<a id="render-volume-templates" class="anchor" href="#render-volume-templates" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Render volume templates</h3>

<pre><code>voletc render test-0.1.1-dev
</code></pre>

<h3>
<a id="remove-a-volume" class="anchor" href="#remove-a-volume" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Remove a volume</h3>

<pre><code>voletc rm test-0.1.1-dev
</code></pre>

<p>To remove the volume without being prompted include the <code>-y</code> flag.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<p>The current supported platforms are <a href="#linux">Linux</a> and <a href="#os-x">OS X</a>.  Download the package from the <a href="https://github.com/ipkg/voletc/releases">releases</a> page.</p>

<h3>
<a id="linux" class="anchor" href="#linux" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Linux</h3>

<p>Download the linux package from <a href="https://github.com/ipkg/voletc/releases">here</a>.  Once downloaded, untar and execute the installer.</p>

<pre><code># Untar
tar -zxvf voletc-0.1.6-linux.tgz

# Run installer
./voletc-installer.sh
</code></pre>

<p>This will install the binary and startup script.</p>

<ul>
<li>/usr/local/bin/voletc</li>
<li>/etc/init/voletc.conf</li>
</ul>

<p>You can now start the service as follows:</p>

<pre><code># Start the agent
start voletc

# Make sure it is running
status voletc
</code></pre>

<p>To troubleshoot the service check the log located at <code>/var/log/voletc.log</code></p>

<h3>
<a id="os-x" class="anchor" href="#os-x" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>OS X</h3>

<p>Download the darwin package from <a href="https://github.com/ipkg/voletc/releases">here</a>.  Once downloaded, untar the package.  You can now start using the <code>voletc</code> binary.  A detailed description on the usage can be found in the <a href="#command-line"><strong>CLI</strong></a> section.</p>

<h3>
<a id="roadmap" class="anchor" href="#roadmap" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Roadmap</h3>

<ul>
<li>Support for an encryption interface for stored data. </li>
<li>Support for etcd as a backend.</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/ipkg/voletc">vol-etc</a> is maintained by <a href="https://github.com/ipkg">ipkg</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
